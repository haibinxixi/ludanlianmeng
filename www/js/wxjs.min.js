function LoadWX(n,t){isLoad||(console.log("LoadWX"),typeof wx=="undefined"&&loadCount<2?(loadExtentFile("https://res.wx.qq.com/open/js/jweixin-1.1.0.js?v=5","js",function(){wxJsLoadSuccessCallback(n,t)},wxJsLoadErrorCallback),console.log("wxload count:"+loadCount)):typeof wx!="undefined"?wxJsLoadSuccessCallback(n,t):$.modal({title:"",text:"微信服务无法加载，请重试",buttons:[{text:"取消",className:"default",onClick:function(){$.modal({title:"",text:"不加载微信服务将无法使用扫码建任务功能，确定吗？",buttons:[{text:"确定",onClick:function(){}},{text:"重试",onClick:function(){loadCount=0;LoadWX(n,t)}}]})}},{text:"重试",onClick:function(){loadCount=0;LoadWX(n,t)}},]}))}function GetSignature(){var n=randomString();$.ajax({type:"post",contentType:"text/json",url:"//dt.newditui.com/Weixin/GetJSSingnature",data:'{"noncestr":"'+n+'","timestamp":"'+timestamp+'","url":"'+window.location.href.split("#")[0]+'"}',dataType:"json",error:function(){loadCount<2&&setTimeout("GetSignature()",1e3);loadCount++},success:function(t){wx.config({debug:typeof WXDEBUG=="boolean"?WXDEBUG:!1,appId:WX_appId,timestamp:timestamp,nonceStr:n,signature:t.ResultOBJ,jsApiList:["showMenuItems","hideAllNonBaseMenuItem","scanQRCode","getLocation","onMenuShareAppMessage","onMenuShareTimeline","chooseImage","uploadImage","downloadImage","previewImage"]})}})}function wxJsLoadSuccessCallback(n,t){isLoad=!0;console.log("wxJsLoadSuccessCallback");GetSignature();wx.ready(n);wx.error(t)}function wxJsLoadErrorCallback(){console.log("wxJsLoadErrorCallback");loadCount++;LoadWX()}function hideMenu(n){typeof wx!="undefined"&&(n?wx.hideMenuItems({menuList:n}):wx.hideAllNonBaseMenuItem())}function showMenu(n){typeof wx!="undefined"&&(n?wx.showMenuItems({menuList:n}):wx.showAllNonBaseMenuItem())}function showShareMenu(n){var t={menuList:[]};n==undefined||n=="all"?(t.menuList.push("menuItem:share:appMessage"),t.menuList.push("menuItem:share:timeline"),t.menuList.push("menuItem:share:qq")):n=="appMessage"?t.menuList.push("menuItem:share:appMessage"):t.menuList.push("menuItem:share:timeline");wx.showMenuItems(t)}function onMenuShareAppMessage(n,t,i,r,u,f){wx.onMenuShareAppMessage({title:n,desc:t,link:i,imgUrl:r,type:"link",dataUrl:"",success:function(){$.toast("分享成功");u&&u()},cancel:function(){$.toast("取消分享");f&&f()}})}function onMenuShareQQ(n,t,i,r,u,f){wx.onMenuShareTimeline({title:n,link:t,imgUrl:r,success:function(){$.toast("分享成功");u&&u()},cancel:function(){$.toast("取消分享");f&&f()}})}function onMenuShareTimeline(n,t,i,r,u){wx.onMenuShareTimeline({title:n,link:t,imgUrl:i,success:function(){$.toast("分享成功");r&&r()},cancel:function(){$.toast("取消分享");u&&u()}})}var timestamp=Math.round((new Date).getTime()/1e3),loadCount=0,isLoad=!1,randomString=randomString||function(n){n=n||32;var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890",u=t.length,r="";for(i=0;i<n;i++)r+=t.charAt(Math.floor(Math.random()*u));return r};