function GetValueFromBName(n,t){var u,r;if(n)for(u=n.split(";"),i=0;i<u.length;i++)for(r=u[i].split(":"),j=0;j<r.length;j++)if(r[0]==t)return r[1];return""}function FixTaskObjRestrict(n){var t,i;n.R_SHARE_TITLE=n.T_NAME+"送您"+n.T_BROKERAGE+"元,速度抢！";n.R_SHARE_DESC="卤蛋部落,可能是最专业靠谱的网赚平台,实现你的躺赚梦想！";n.R_FXJL1=0;n.R_FXJL2=0;for(i in n.RESTRICT_LIST){t=n.RESTRICT_LIST[i];switch(t.R_TYPE){case 3:n.R_AREA=t.R_VALUE;break;case 6:n.R_OPENTIME=t.R_VALUE;break;case 7:n.R_NUM_LIMIT=t.R_VALUE;break;case 8:n.R_STAR=Number(t.R_VALUE);break;case 10:n.R_STOP=Number(t.R_VALUE);break;case 13:n.R_DUIZHANG=t.R_VALUE;case 14:n.R_MAIDIANMIAOSHU=t.R_VALUE;break;case 15:n.R_WJURL=t.R_VALUE;break;case 16:n.R_DAISHENMIAOSHU=t.R_VALUE;break;case 17:n.R_OAUTH=t.R_VALUE;break;case 18:n.R_ACTION=t.R_VALUE.split(",");break;case 20:t.R_VALUE.split("$$$$").length>1?(n.R_SHARE_TITLE=restrict.R_VALUE.split("$$$$")[0],n.R_SHARE_DESC=restrict.R_VALUE.split("$$$$")[1]):n.R_SHARE_DESC=restrict.R_VALUE.split("$$$$")[0];break;case 21:n.R_FXJL1=Number(t.R_VALUE);break;case 22:n.R_FXJL2=Number(t.R_VALUE);break;case 23:n.R_NOTPAY=Number(t.R_VALUE)}}}function TaskGetTaskListDetail(n){FuncAjax("/task/GetTaskList/"+OPENID,"",function(n){n.ResultOBJ!=null&&(init_task_list(n.ResultOBJ),beginTime=+new Date,CheckNotUploadTask())},function(){alert("获取任务列表出错")},n?n:!1)}function CheckNotUploadTask(){var n=taskObj.find(function(n){return n.T_STATE==1&&n.PROOF_LIST.length==0});n&&$.modal({title:"",text:'<div class="text-left">您报名的<span class="green">'+n.T_NAME+"<\/span>还未提交证据，完成任务后才能继续做其他任务。<\/div>",buttons:[{text:"继续完成任务",onClick:function(){TaskDetailShow(n.ID)}},]})}function task_filter(n){var r=new Date,i=[],t;if(MyInfo.U_CREDITLEVEL==-1)return i;for(t=0;t<n.length;t++)FixTaskObjRestrict(n[t]),i.push(n[t]);return i}function checkLocationTaskShow(n){var f=n.R_AREA,r,i,t,u;if(f)if(locationObj){for(r=f.split(";"),i=0;i<r.length;i++)for(t=r[i].split(":"),u=0;u<t.length;u++)if(t[0]=="省"&&t[1].indexOf(locationObj.REGION)>-1||t[0]=="市"&&t[1].indexOf(locationObj.CITY)>-1)return t[1].indexOf("!")>-1?!1:!0}else $.modal({title:"",text:'<i class="fas fa-info-circle orange text-m"><\/i>位置信息获取失败<br>请在手机设置中打开定位功能。',buttons:[{text:"刷新页面重试",onClick:function(){location.reload(!0)}},]});else return!0}function init_task_list(n){var i,r,t;for(taskObjAll=n,taskObjAll.sort(function(n,t){return n.ID<t.ID?1:-1}),taskObjNest=d3.nest().key(function(n){return n.ID}).map(taskObjAll,d3.map),taskObj=task_filter(taskObjAll),$("#task_list").empty(),$("#detils_lists").empty(),i=!0,r=!0,t=0;t<taskObj.length;t++)taskObj[t].T_STATE==0?(i=!1,$("#task_list").append(TaskListDom(taskObj[t]))):(r=!1,$("#detils_lists").append(TaskIncomeListDom(taskObj[t])));i&&$("#task_list").html('<div class="padding-area text-s text-center" onclick="OpenPage(\'wallet_page\')">暂无未报名任务，请在<span class="green">[我的]<\/span>中查看已报名任务<\/div>');r&&$("#detils_lists").html('<div class="padding-area text-s text-center" onclick="OpenPage(\'task_page\')">暂无,请在<span class="green">[任务]<\/span>中报名开始赚钱!<\/div>')}function TaskIncomeListDom(n){var t='<div class="weui-cell task-list" onclick="TaskDetailShow('+n.ID+');">';return t+='<div class="weui-cell__bd weui-cell__primary"><p  class="task-name">'+n.T_NAME+'<span class="pull-right orange">赏金<b class="text-l ">￥'+n.T_BROKERAGE+"<\/b><\/span><\/p>",t+='<div class="task-label text-s">[任务状态] ',n.T_STATE==1?t+='<span class="green">待完成<\/span>':n.T_STATE==2?t+='<span class="green">待审核<\/span>':n.T_STATE==3?t+='<span class="orange">已打款<\/span>':n.T_STATE==4&&(t+='<span class="grey">失败原因：'+R_AUDIT_COMMENT+"<\/span>"),t+="<\/div>",t+"<\/div><\/div>"}function TaskListDom(n){var t='<div class="weui-cell task-list" onclick="TaskDetailShow('+n.ID+');">';return t+='<div class="weui-cell__hd"><img src="/'+n.T_ICON+'" alt="'+n.T_NAME+'" onerror="errorImg(this)"/><\/div>',t+='<div class="weui-cell__bd weui-cell__primary"><p class="task-name">',n.T_SUMMARY&&(t+='<span class="green">'+n.T_SUMMARY+"<\/span>",t+='<span class="fa-layers fa-fw text-xl"><i class="fas fa-certificate green"><\/i><span class="fa-layers-text fa-inverse white" data-fa-transform="shrink-6" style="font-weight:400">'+n.T_SUMMARY.substr(0,1)+"<\/span><\/span>"),t+=n.T_NAME+"<\/p>",t+=n.T_TOTALNUM<0?'<div class="task-label text-s"><i class="fas fa-info-circle green" aria-hidden="true"><\/i> 名额无限制<\/div>':'<div class="task-label text-s"><i class="fas fa-info-circle green" aria-hidden="true"><\/i> 剩余:'+n.T_OVERPLUSNUM+"个名额<\/div>",n.T_PROMOTION_AREA==null||n.T_PROMOTION_AREA==""||n.T_PROMOTION_AREA=="暂无"||(t+='<div class="task-label label text-s"><i class="fas fa-map-marker green" aria-hidden="true"><\/i> '+n.T_PROMOTION_AREA+"<\/div>"),t+="<\/div>",n.R_STOP==1?t+='<div class="weui-cell__ft task-income"><div><em>暂停推广<\/em><\/div>':n.T_STATE==0?t+='<div class="weui-cell__ft task-income"><div  class="orange">赏<em>￥'+n.T_BROKERAGE+"<\/em><\/div>":n.T_STATE==1?t+='<div class="weui-cell__ft task-income"><div  class="orange">赏<em>￥'+n.T_BROKERAGE+'<\/em>(已接)<\/div><div class="orange"><\/div>':n.T_STATE==2?t+='<div class="weui-cell__ft task-income"><div  class="orange">赏<em>￥'+n.T_BROKERAGE+'<\/em>(待审)<\/div><div class="orange"><\/div>':n.T_STATE==3?t+='<div class="weui-cell__ft task-income"><div  class="orange">赏<em>￥'+n.T_BROKERAGE+'<\/em>(完成)<\/div><div class="orange"><\/div>':n.T_STATE==4&&(t+='<div class="weui-cell__ft task-income"><div  class="orange">赏<em>￥'+n.T_BROKERAGE+'<\/em>(失败)<\/div><div class="orange"><\/div>'),n.R_FXJL1&&(t+='<span class="orange text-s">分享再赏 <b class="text-l">￥'+n.R_FXJL1+"<\/b><\/span>"),t+="<\/div>",t+"<\/div>"}function TaskDetailShow(n){if(currentTaskObj=taskObjNest.get(n)[0],currentTaskObj.R_STOP==1){var t=[{text:"确定",className:"default",onClick:function(){$.closeModal()}}],i="["+currentTaskObj.T_NAME+"]<br>此任务已暂停推广，请查看其他任务。<br><br>";$.modal({title:"",text:i,buttons:t,autoClose:!1});OpenPage("task_page");return}StatisticalPageEx(1);InitTaskDetail()}function InitTaskDetail(){var n="",f,e,t,r,i,u;if($("#tasks").empty(),n+='<div class="weui-form-preview" style="box-shadow: 0px 2px 5px #888888;z-index:1">',n+='<div class="weui-cell task-list green-bg white">',n+='<div class="weui-cell__hd"><img src="/'+currentTaskObj.T_ICON+'" onerror="errorImg();"><\/div>',n+='<div class="weui-cell__bd weui-cell__primary">',n+='<div class="task-name">'+currentTaskObj.T_NAME+"<\/div>",n+=currentTaskObj.T_TOTALNUM<0?'<div class="task-label text-s white"><i class="fas fa-info-circle" aria-hidden="true"><\/i> 名额无限制<\/div>':'<div class="task-label text-s white"><i class="fas fa-info-circle" aria-hidden="true"><\/i> 剩余: '+currentTaskObj.T_OVERPLUSNUM+"个名额<\/div>",n+="<\/div>",$.CountDown.stop("#overall-btn-baoming-btn"),currentTaskObj.R_STOP==1?n+='<div class="weui-cell__ft task-income"><div><em>暂停推广<\/em><\/div>':currentTaskObj.T_STATE==0?n+='<div class="weui-cell__ft white"><div class="task-income">赏<em class="yellow">￥'+currentTaskObj.T_BROKERAGE+"<\/em><\/div>":currentTaskObj.T_STATE==1?n+='<div class="weui-cell__ft white"><div class="task-income">赏<em class="yellow">￥'+currentTaskObj.T_BROKERAGE+"<\/em>(已接)<\/div>":currentTaskObj.T_STATE==2?n+='<div class="weui-cell__ft white"><div class="task-income">赏<em class="yellow">￥'+currentTaskObj.T_BROKERAGE+"<\/em>(待审)<\/div>":currentTaskObj.T_STATE==3?n+='<div class="weui-cell__ft white"><div class="task-income">赏<em class="yellow">￥'+currentTaskObj.T_BROKERAGE+"<\/em>(完成)<\/div>":currentTaskObj.T_STATE==4&&(n+='<div class="weui-cell__ft white"><div class="task-income">赏<em class="yellow">￥'+currentTaskObj.T_BROKERAGE+"<\/em>(失败)<\/div>"),n+='<span class="text-s">'+GetCycleStr(currentTaskObj.T_CYCLE)+"<\/span><\/div>",n+="<\/div>",n+='<div class="weui-form-preview__ft">',n+='<a class="weui-form-preview__btn weui-form-preview__btn_primary" href="javascript:ShowHaibao()"><i class="fas fa-fw fa-qrcode"><\/i> 我的专属推广码<\/a>',n+='<a class="weui-form-preview__btn green" href="javascript:ShowShareDialog()"><i class="fas fa-fw fa-share-alt"><\/i> 分享',currentTaskObj.R_FXJL1&&currentTaskObj.R_FXJL1>0&&(n+='(再赏 <span class="orange">￥'+currentTaskObj.R_FXJL1+"<\/span>)"),n+="<\/a>",n+="<\/div>",n+="<\/div>",f="",n+='<div style="overflow-y: scroll;height:100%;padding-bottom:220px;-webkit-overflow-scroll:touch">',f=currentTaskObj.T_DESCRIPTION==null?"暂无":currentTaskObj.T_DESCRIPTION==""?"暂无":currentTaskObj.T_DESCRIPTION,n+='<div class="weui-panel"><div class="weui-panel__hd"><span class="weui-panel__hd_icon green-bg white"><\/span>任务说明<\/div><div class="weui-panel__bd"><div class="weui-media-box weui-media-box_text text-dq" style="padding-top:0px;"><p class="weui-media-box__desc">'+f+"<\/p><\/div><\/div><\/div>",n+='<div class="weui-panel"><div class="weui-panel__hd"><span class="weui-panel__hd_icon green-bg white"><\/span>任务步骤<\/div>',n+='<div class="weui-panel__bd">',n+='<div class="task_step">',e=convertQRcodeImage(currentTaskObj.T_URL),n+='<div class="weui-panel__hd"><span class="task_step_nr green-bg white">第1步<\/span>按住识别二维码：<\/div>',n+=currentTaskObj.T_STATE>0?'<div class="weui-panel__hd2"><div class="task_step_item text-center"><img src="'+e+'"><\/div><\/div>':'<div class="weui-panel__hd2 weui-panel__hd2_center text-center orange">报名成功后立即显示二维码<\/div>',n+='<div class="clearfix"><\/div><\/div>',currentTaskObj.COURSE_LIST!=null)for(t=1,i=0;i<currentTaskObj.COURSE_LIST.length;i++)n+='<div class="task_step">',n+='<div class="weui-panel__hd" style="text-indent:-56px;margin-left:56px"><span class="task_step_nr green-bg white">第'+(i+2)+"步<\/span>",n+=currentTaskObj.COURSE_LIST[i].CS_NAME?"<span>"+currentTaskObj.COURSE_LIST[i].CS_NAME+"<\/span><\/div>":"<\/div> ",n+='<div class="weui-panel__hd2 text-center">',currentTaskObj.COURSE_LIST[i].CS_TYPE==1?(n+='<div class="task_step_item"><img class="task_step_item_img" onload="javascript:$(this).parent().addClass(\'task_step_item_img_proof\')" src="'+currentTaskObj.COURSE_LIST[i].CS_URL+'"><\/div>',r=currentTaskObj.PROOF_LIST.find(function(n){return n.P_ACTION==t}),n+=r?'<div id="action_'+t+'" class="task_step_item"><img class="task_step_item_img" src="'+g_OSSHost+r.P_URL+'"><a class="weui-btn weui-btn_orange" href="javascript:void(0)" onclick="ShowUploadFileDialog('+t+')"><p>更换<\/p><\/a><\/div>':'<div id="action_'+t+'" class="task_step_item"><a class="weui-btn weui-btn_primary" href="javascript:void(0)" onclick="ShowUploadFileDialog('+t+')"><i class="fas fa-fw fa-image"><\/i>上传<\/a><\/div>',t++):currentTaskObj.COURSE_LIST[i].CS_TYPE==2?(n+='<div class="task_step_item"><img src="'+currentTaskObj.COURSE_LIST[i].CS_URL+'"><\/div>',r=currentTaskObj.PROOF_LIST.find(function(n){return n.P_ACTION==t}),n+=r?'<div id="action_'+t+'" class="task_step_item"><p>'+r.P_DATA+'<\/p><a class="weui-btn weui-btn_orange" href="javascript:void(0)" onclick="ShowSubmitTextDialog('+t+","+r.ID+",'"+r.P_DATA+"')\"><p>修改<\/p><\/a><\/div>":'<div id="action_'+t+'" class="task_step_item"><a class="weui-btn weui-btn_primary" href="javascript:void(0)" onclick="ShowSubmitTextDialog('+t+')"><i class="fas fa-fw fa-pencil"><\/i>记录<\/a><\/div>',t++):currentTaskObj.COURSE_LIST[i].CS_TYPE==0&&(n+='<div class="task_step_item task_step_item_img_notproof text-center"><img class="task_step_item_img" src="'+currentTaskObj.COURSE_LIST[i].CS_URL+'"><\/div>'),n+='<div class="clearfix"><\/div><\/div><\/div>';n+="<\/div><\/div><\/div><\/div><\/div><\/div><\/div>";$("#tasks").append(n);OpenPage("task_details_cover");SetTaskBtn();u=g_UrlHost+"/view/pushpage9.html?tid="+currentTaskObj.ID+"&o="+OPENID+"&u="+MyInfo.ID+"&l=1";onMenuShareAppMessage(currentTaskObj.R_SHARE_TITLE,currentTaskObj.R_SHARE_DESC,u,g_UrlHost+"/"+currentTaskObj.T_ICON,ShareSuccessCallback,ShareCancelCallback);onMenuShareQQ(currentTaskObj.R_SHARE_TITLE,currentTaskObj.R_SHARE_DESC,u,g_UrlHost+"/"+currentTaskObj.T_ICON,ShareSuccessCallback,ShareCancelCallback);onMenuShareTimeline(currentTaskObj.R_SHARE_TITLE,u,g_UrlHost+"/"+currentTaskObj.T_ICON,ShareSuccessCallback,ShareCancelCallback)}function InitImgUploader(){uploader=new plupload.Uploader({runtimes:"html5,html4",browse_button:$("#uploadCache")[0],filters:{max_file_size:"10mb"},resize:{height:1080,quality:70},multi_selection:!1,url:"http://oss.aliyuncs.com",init:{PostInit:function(){},BeforeUpload:function(n,t){var i=new Date,r="zl/"+currentTaskObj.ID+"/"+i.format("yyyy-MM-dd")+"/"+currentTaskObj.ID+"_"+MyInfo.ID+"_"+currentTaskObj.TL_ID+"_"+currentAction+"/"+i.format("yyyyMMddhhmmssS")+getSuffix(t.name);set_upload_param(n,r,currentTaskObj.ID)},FilesAdded:function(n){$.showLoading();$("#uploaderFiles").append("");n.start()},FilesRemoved:function(){},UploadProgress:function(n,t){$(".weui-toast_content").html(t.percent+"%")},FileUploaded:function(n,t,i){$.hideLoading();var r=JSON.parse(i.response);r.ResultCode==0?(currentTaskObj.PROOF_LIST.push(r.ResultOBJ),UpdateActionProof(r.ResultOBJ)):$.alert("上传失败，请重试")},UploadComplete:function(){},Error:function(n,t){console.log(t.response)}}});uploader.init()}function UpdateActionProof(n){n.P_TYPE==2?($("#action_"+n.P_ACTION).html("<p>"+n.P_DATA+'<\/p><a class="weui-btn weui-btn_orange" href="javascript:void(0)" onclick="ShowSubmitTextDialog('+n.P_ACTION+","+n.ID+",'"+n.P_DATA+"')\"><p>修改<\/p><\/a>"),$("#action_"+n.P_ACTION).addClass("weui-flex__item3"),$("#action_"+n.P_ACTION).removeClass("weui-flex__item")):n.P_TYPE==3&&($("#action_"+n.P_ACTION).html('<img src="'+g_OSSHost+n.P_URL+'" style="width:100%;height:auto;" ><a class="weui-btn weui-btn_primary" href="javascript:void(0)" onclick="ShowUploadFileDialog('+n.P_ACTION+')"><p>更换<\/p><\/a>'),$("#action_"+n.P_ACTION).addClass("weui-flex__item3"),$("#action_"+n.P_ACTION).removeClass("weui-flex__item"))}function GetCycleStr(n){return n==0?"秒审核":n+"小时内审核打款"}function GetTaskClassName(n){var t="";switch(n){case 1:t="APP推广";break;case 2:t="微信加粉";break;case 3:t="H5页面推广";break;case 4:t="推B端"}return t}function ShowHaibao(){$.modal({title:"",text:'<div id="qrModalContent"><div class="qrcodeImgDiv text-center"><i id="haibaoImgZoomLoading" class="weui-loading weui-icon_toast"><\/i><img id="haibaoImgZoom" class="hidden" style="width:70%;height:auto"  src=""><\/div><div class="green padding-area-sm text-left" style="text-" id="qrcodeTips"><i class="fas fa-exclamation-circle" aria-hidden="true"><\/i>&nbsp;这是您的专属推广二维码。<br>按住可以保存至手机相册。<\/p><\/div><br><\/div>',buttons:[{text:"返回",className:"default"}]});hecheng()}function hecheng(){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=640;t.height=960;n.rect(0,0,t.width,t.height);n.fillStyle="#fff";n.fill();var r=new Image,u=new Image,i=new Image;r.src=$("#qrcodeBg").attr("src");r.onload=function(){n.drawImage(r,0,0,640,960);u.src=convertQRcodeImage(g_UrlHost+"/view/pushpage9.html?tid="+currentTaskObj.ID+"&o="+OPENID+"&u="+MyInfo.ID+"&l=1");u.onload=function(){n.drawImage(u,210,532,220,220);i.src="/"+currentTaskObj.T_ICON;i.onload=function(){n.drawImage(i,290,612,60,60);n.font="small-caps bold 46px arial";n.fillStyle="#fff400 ";n.textAlign="center";n.fillText("任务赏金￥"+currentTaskObj.T_BROKERAGE,320,300);currentTaskObj.R_FXJL1>0&&n.fillText("分享再赏￥"+currentTaskObj.R_FXJL1,320,370);n.font="22px 'microsoft yahei'";n.fillStyle="#fff";n.textAlign="center";n.fillText("["+currentTaskObj.T_NAME+"]"+currentTaskObj.ID+" ("+MyInfo.ID+")",320,880);$("#haibaoImgZoomLoading").remove();$("#haibaoImgZoom").removeClass("hidden");document.getElementById("haibaoImgZoom").src=t.toDataURL("image/jpeg",1)};i.onerror=function(){n.font="small-caps bold 46px arial";n.fillStyle="#fff400 ";n.textAlign="center";n.fillText("任务赏金￥"+currentTaskObj.T_BROKERAGE,320,300);currentTaskObj.R_FXJL1>0&&n.fillText("分享再赏￥"+currentTaskObj.R_FXJL1,320,370);n.font="22px 'microsoft yahei'";n.fillStyle="#fff";n.textAlign="center";n.fillText("["+currentTaskObj.T_NAME+"]"+currentTaskObj.ID+" ("+MyInfo.ID+")",320,880);$("#haibaoImgZoomLoading").remove();$("#haibaoImgZoom").removeClass("hidden");document.getElementById("haibaoImgZoom").src=t.toDataURL("image/jpeg",1)}}}}function TaskReceiveTaskDialog(){$.modal({title:"",text:'<div class="text-left">当您报名成功后，必须完成<span class="green">提交证据<\/span>或者手动终止才能接下一个任务，确定报名吗？<\/div>',buttons:[{text:"返回",className:"default",onClick:function(){$.closeModal()}},{text:"马上报名",onClick:function(){TaskReceiveTask()}}]})}function TaskReceiveTask(){if(locationObj!=""){if(!checkLocationTaskShow(currentTaskObj)){$.alert("您所在的位置不符合该任务的要求。<br />该任务的目标地域为：["+currentTaskObj.R_AREA.replace(/(省:)|(市:)|(区:)/,"").replace(";",",").replace("!","非")+"]。");return}}else getLocationWX(TaskReceiveTask);FuncAjax("/Task/ReceiveTask/"+currentTaskObj.ID+"/"+OPENID,"",function(n){n.ResultCode==0?($.toast("报名成功"),currentTaskObj.T_COUNT_DOWN=n.ResultOBJ+Math.round((+new Date-beginTime)/1e3),currentTaskObj.T_STATE=1,InitTaskDetail(),init_task_list(taskObjAll),SetTaskBtn(),$.CountDown.begin("#overall-btn-baoming-btn",{countDown:n.ResultOBJ,callback:function(){}}),currentTaskObj.TL_ID||StatisticalPage("",currentTaskObj.ID)):$.alert(n.ResultMsg)},null,!0)}function TaskCancelTask(){FuncAjax("/Task/CancelTask/"+currentTaskObj.ID+"/"+OPENID,"",function(n){n.ResultCode==0?($.toast("取消成功"),currentTaskObj.T_STATE=0,InitTaskDetail(),init_task_list(taskObjAll),SetTaskBtn()):$.alert(n.ResultMsg)},null,!0)}function TaskSubmitTask(){var n=currentTaskObj.COURSE_LIST.filter(function(n){return n.CS_TYPE!=0});if(currentTaskObj.PROOF_LIST.length<n.length){$.alert("您忘了上传截图了！");return}FuncAjax("/Task/SubmitTask/"+currentTaskObj.ID+"/"+OPENID,"",function(n){n.ResultCode==0?($.alert("提交成功，请等待审核。审核通过后将自动打款到您的余额。",""),currentTaskObj.T_STATE=2,InitTaskDetail(),init_task_list(taskObjAll)):n.ResultCode==1?($.alert("此任务的报名已超时，请重新报名"),currentTaskObj.T_COUNT_DOWN=0,currentTaskObj.T_STATE=0,InitTaskDetail(),init_task_list(taskObjAll),SetTaskBtn()):n.ResultCode==2?$.alert("此任务您还没有报名"):n.ResultCode==3&&$.alert("任务不存在")},null,!0)}function SetTaskBtn(){switch(currentTaskObj.T_STATE){case 0:$("#overall-btn-baoming-btn").html("马上报名");$("#overall-btn-baoming-btn").addClass("weui-btn_primary");$("#overall-btn-baoming-btn").removeClass("weui-btn_orange");$("#overall-btn-baoming-btn").attr("href","javascript: TaskReceiveTaskDialog();");$("#overall-btn-back").removeClass("hidden");$("#overall-btn-baoming").removeClass("hidden");$("#overall-btn-cancel").addClass("hidden");break;case 1:$("#overall-btn-baoming-btn").html("提交证据");$("#overall-btn-baoming-btn").removeClass("weui-btn_primary");$("#overall-btn-baoming-btn").addClass("weui-btn_orange");$("#overall-btn-baoming-btn").attr("href","javascript: TaskSubmitTask();");$.CountDown.begin("#overall-btn-baoming-btn",{countDown:currentTaskObj.T_COUNT_DOWN-Math.round((+new Date-beginTime)/1e3),callback:function(){}});$("#overall-btn-back").addClass("hidden");$("#overall-btn-baoming").removeClass("hidden");$("#overall-btn-cancel").removeClass("hidden");break;case 2:$("#overall-btn-back").removeClass("hidden");$("#overall-btn-baoming").addClass("hidden");$("#overall-btn-cancel").addClass("hidden");break;case 3:$("#overall-btn-back").removeClass("hidden");$("#overall-btn-baoming").addClass("hidden");$("#overall-btn-cancel").addClass("hidden");break;case 4:$("#overall-btn-back").removeClass("hidden");$("#overall-btn-baoming").addClass("hidden");$("#overall-btn-cancel").addClass("hidden")}currentTaskObj.R_STOP&&($("#overall-btn-back").removeClass("hidden"),$("#overall-btn-baoming").addClass("hidden"),$("#overall-btn-cancel").addClass("hidden"))}function set_upload_param(n,t){var i={callbackUrl:"http://zl.newditui.com/stats/OssCallback",callbackBody:'{"U_ID":'+MyInfo.ID+',"T_ID":'+currentTaskObj.ID+',"TL_ID":'+currentTaskObj.TL_ID+',"P_ACTION":'+currentAction+',"P_URL":${object}}',callbackBodyType:"application/json"},r={key:t,policy:policyBase64,OSSAccessKeyId:accessid,success_action_status:"200",signature:signature,callback:Base64.encode(JSON.stringify(i))};n.setOption({url:host,multipart_params:r})}function ShowUploadFileDialog(n){var t="";currentTaskObj.R_STOP==1?t="任务已暂停推广，请返回查看其他任务。":currentTaskObj.T_STATE==0?t="您还没有报名，请先报名再上传证据。":currentTaskObj.T_STATE==1?(currentAction=n,$("input[type='file']").trigger("click")):currentTaskObj.T_STATE==2?t="任务已提交证据，无法修改，请等待审核。":currentTaskObj.T_STATE==3&&(t="任务已通过审核，请到钱包查询余额。");t!=""&&$.alert(t)}function UpdateFileNum(){$("#uploader_curnum").html($("#uploaderFiles .weui-uploader__file:not(.weui-uploader__file_status)").length);$("#uploader_maxnum").html($("#uploaderFiles .weui-uploader__file").length);$("#uploaderFiles li").length>=1?$("#upload_container").addClass("hidden"):($("#upload_container").removeClass("hidden"),uploader&&uploader.refresh())}function RemoveUploaderImg(){var t=$("#gallery").attr("data-not-upload"),n=$("#gallery").attr("data-proof-id"),i=$("#gallery").attr("data-tid");t=="1"?(uploader.removeFile(fileid),$("#"+fileid).remove()):FuncAjax("/Task/RemoveTaskStatisticsFile/"+i,n,function(t){var i,r;t.ResultCode==0&&($("#uploaderFiles .weui-uploader__file[data-proof-id='"+n+"']").remove(),i=CurrentPage!="task_page"?taskLogObj.find(function(n){return n.ID==Number($("#upload_container").attr("data-tlid"))}):taskDoStatsLogObj.find(function(n){return n.ID==Number($("#upload_container").attr("data-tlid"))}),r=i.PROOF_LIST.find(function(t){return t.ID==n}),i.PROOF_LIST.splice(i.PROOF_LIST.indexOf(r),1),UpdateFileNum())},null,!0)}function ShowSubmitTextDialog(n,t,i){var r=[{text:"返回",className:"default",onClick:function(){$.closeModal()}}],u='<div class="weui-cells"><div class="weui-cell"><div class="weui-cell__bd"><input id="txt_proof_text" class="weui-input text-m" type="text" value="'+(i?i:"")+'" placeholder="请输入内容" data-pid="'+(t>>0)+'"><\/div><div class="weui-cell__ft"><a class="weui-btn weui-btn_primary" href="javascript:void(0);" onclick="SubmitText(this,'+(t>>0)+","+n+')">提 交<\/a><\/div><\/div><\/div>';$.modal({title:"",text:u,buttons:r,autoClose:!1})}function SubmitText(n,t,i){var r=$(n),u,f;r.hasClass("weui-btn_disabled")||(u=$("#txt_proof_text").val(),u?(r.html("提交中"),r.addClass("weui-btn_disabled weui-btn_default"),r.removeClass("weui-btn_primary"),f={ID:Number(t),T_ID:currentTaskObj.ID,U_ID:MyInfo.ID,TL_ID:currentTaskObj.TL_ID,P_TYPE:2,P_ACTION:i,P_DATA:u},FuncAjax("/Task/SaveTaskProofText/"+OPENID,JSON.stringify(f),function(n){r.html("记录手机");r.removeClass("weui-btn_disabled weui-btn_default");r.addClass("weui-btn_primary");n.ResultCode==0&&($.toast("已保存内容"),$.closeModal(),f.ID==0?currentTaskObj.PROOF_LIST.push(n.ResultOBJ):currentTaskObj.PROOF_LIST.find(function(t){return t.ID==n.ResultOBJ.ID}).P_DATA=n.ResultOBJ.P_DATA,UpdateActionProof(n.ResultOBJ))},function(){r&&(r.html("提 交"),r.removeClass("weui-btn_disabled weui-btn_default"),r.addClass("weui-btn_primary"))},!0)):$.toast("请输入内容","cancel"))}function GetProofStr(n,t){var r=n,i,e,f,u,o;return t.T_CLASS==4?(e=JSON.parse(r.GUEST_UA),i=e.q1):(f=r.PROOF_LIST.find(function(n){return n.P_TYPE==1&&n.P_EXDATA=="1"}),f==null&&r.PROOF_LIST.find(function(n){return n.P_TYPE==1&&n.P_EXDATA=="0"}),u=r.PROOF_LIST.find(function(n){return n.P_TYPE==2}),o=r.PROOF_LIST.find(function(n){return n.P_TYPE==3}),i="[暂无]",t.R_DUIZHANG=="2"?u!=null&&(i=u.P_PHONE):f!=null?i=f.P_DATA:u!=null?i=u.P_PHONE:r.GUEST_MAC!=null&&(i=r.GUEST_MAC.substr(0,8)),o!=null&&(i+=' <i class="fas fa-photo"><\/i>')),i}function init_QRcode(n,t,i,r,u){var f=g_UrlHost+"/view/index_g.html?tid="+n+"&o="+t+"&u="+MyInfo.ID+"&type="+i+"&s="+r+"&a="+u;convertQRcodeImage(f,"QR_img")}function convertQRcodeImage(n,t){if($("#qrcode canvas").remove(),$("#qrcode").qrcode({width:600,height:600,text:n}),typeof t!="undefined")$("#"+t).attr("src",$("#qrcode canvas")[0].toDataURL("image/png")),$("#"+t).attr("data-src",n),$("#qrcode canvas").remove();else return $("#qrcode canvas")[0].toDataURL("image/png")}function openTaskLink(n){var t="";currentTaskObj.R_STOP==1?t="任务已暂停推广，请返回查看其他任务。":currentTaskObj.T_STATE==0?t="您还没有报名，请先报名再开始任务。":(currentTaskObj.T_STATE==1||currentTaskObj.T_STATE==2||currentTaskObj.T_STATE==3)&&(StatisticalPageEx(2),window.history.pushState("turl",null,"pushpage9.html?&opentask="+encodeURIComponent(n)),$("#llqcover").removeClass("hidden"),showMenu(["menuItem:openWithSafari","menuItem:openWithQQBrowser","menuItem:originPage"]));t!=""&&$.alert(t)}function InitWalletDetail(){$("#wallet_available").html(FenToYuan(MyInfo.U_TOTALPROFIT-MyInfo.U_ALREADYWITHDRAWALS));$("#wallet_already").html(FenToYuan(MyInfo.U_ALREADYWITHDRAWALS));MyInfo.U_TOTALPROFIT-MyInfo.U_ALREADYWITHDRAWALS<=0&&$("#tixian_btn").addClass("opacity50")}function Withdrawals(){if(MyInfo.U_TOTALPROFIT<=0){$.alert("您还没有余额，干活拿奖励，入账再来提现吧","");return}var n="";n+='<div class="grey text-center text-s padding-area"><ul class="weui_text_area text-left"><li><i class="fas fa-fw fa-star green text-m"><\/i> 单笔最小金额为1元，单笔最大限额200元；<\/li><li><i class="fas fa-fw fa-star green text-m"><\/i> 每个会员每天最多可提现6次；<\/li><li><i class="fas fa-fw fa-star green text-m"><\/i> 同一个会员提款时间间隔不得低于15秒。<\/li><\/ul><p class="orange text-xl padding-area">可用余额：'+FenToYuan(MyInfo.U_TOTALPROFIT-MyInfo.U_ALREADYWITHDRAWALS)+' 元<\/p><input id="wallet_money" class="padding-area-sm text-m task-list-left-f" placeholder="请输入提现金额" type="number"><div class="orange-bg white margin_top_2" id="withdraw_error_msg"><\/div><\/div>';$.modal({title:"提现金额",text:n,buttons:[{text:"返回",className:"default",onClick:function(){$.closeModal()}},{text:"确认提现",onClick:function(){Withdrawals_Verification()&&(UserGetUserWithdrawals(),$.closeModal())}},],autoClose:!1})}function CheckIsAuthentication(){if(MyInfo.U_NAME==null||MyInfo.U_NAME==""||MyInfo.U_NAME.indexOf("(有误)")>-1)return $.modal({title:"",text:'<i class="fas fa-lock" aria-hidden="true"><\/i> 您的报酬将会自动打入您的微信钱包，请在此填写您开通微信钱包时所绑定的银行卡使用的姓名，否则将无法提现！',buttons:[{text:"返回"},{text:"去实名",onClick:function(){$("div[name='cell_nickname']").removeClass("hidden");OpenPage("user_authentication_cover")}}]}),!1;Withdrawals()}function Withdrawals_Verification(){var t=!1,n=$("#wallet_money").val();return n==""?$("#withdraw_error_msg").html("请输入提现金额"):(n=Number(n),n<1?$("#withdraw_error_msg").html("单笔提现金额不得少于1元"):n>200?$("#withdraw_error_msg").html("由于微信限制，单笔提现金额不得多于200元"):n*100>MyInfo.U_TOTALPROFIT?$("#withdraw_error_msg").html("提现金额已经超过可用金额"):t=!0),t}function UserGetUserWithdrawals(){var n="/User/GetUserWithdrawals/"+OPENID+"/"+Token,t=$("#wallet_money").val();FuncAjax(n,t,function(n){n.ResultCode==0?(UserGetUserDetail(),ShowGetHBTip()):$.alert(n.ResultMsg,"")},function(n){$.alert(n.ResultMsg,"")},!0)}function ShowGetHBTip(){$.modal({title:"提现成功",text:'<div><div class="qrcodeImgDiv text-center"><img style="width:100%;height:auto" src="img/get-hb-tip.jpg"><\/div><br><div class="tips_blue padding-area-sm text-left text-dq">如上图，红包将由“微信企业红包”直接给您发送，请注意查看微信“服务通知”查收红包！<\/div><\/div>',buttons:[{text:"确定",className:"default"}]})}function UserGetUserAccountingList(){var n="/User/GetUserAccountingList/"+OPENID+"/"+Token;FuncAjax(n,"",function(n){if(n.ResultCode==0){var t=n.ResultOBJ;t.length>0?DetailedList(t):$("#mingxi_detils_lists").html('<div class="weui-media-box weui-media-box_text text-center">暂无明细<\/div>')}else $.toast(n.ResultMsg,"forbidden")},function(n){$.alert(n.ResultMsg,"")},!0)}function DetailedList(n){for(var t='<div class="weui-cells margin_top_0">',i=0;i<n.length;i++)n[i].A_MONEY!=0&&(t+='<div class="weui-cell task-list"><div class="weui-cell__bd weui-cell__primary"><p  class="task-name orange">',n[i].A_TYPE==4?t+="提现":n[i].A_TYPE==3?t+="任务赏金":n[i].A_TYPE==5&&(t+="分享赏金"),t+="<\/p>",t+='<div class="task-label text-s">'+n[i].A_DESCRIBE+"<\/div>",t+="<\/div>",t+=n[i].A_TYPE!=4?'<div class="task-income"><div><em>+ '+FenToYuan(n[i].A_MONEY)+"<\/em><\/div>":'<div class="task-income"><div><em class="green">- '+FenToYuan(n[i].A_MONEY)+"<\/em><\/div>",t+='<div><span class="text-s">'+dateFormat(n[i].A_TIME,"yyyy-MM-dd hh:mm")+"<\/span><\/div>",t+="<\/div><\/div>");t+="<\/div>";$("#mingxi_detils_lists").html(t)}function Withdrawals_Explain(){$.modal({title:"",text:"平台正在对提现账户审核，24小时内审核通过后，直接提现到您的微信钱包。如发现账户有问题，平台会及时发送通知。请注意查看微信钱包余额变化。",buttons:[{text:"返回",className:"default",onClick:function(){}},]})}function TaskGetTaskShareDetailList(){var n="/Task/GetTaskShareDetailList/"+OPENID;FuncAjax(n,"",function(n){if(n.ResultCode==0){var t=n.ResultOBJ;t.length>0?ShareDetailedList(t):$("#detils_lists").html('<div class="padding-area text-s text-center" onclick="OpenPage(\'task_page\')">暂无分享明细,请在<span class="green">[任务]<\/span>中分享赚钱!<\/div>')}else $.alert(n.ResultMsg,"")},function(n){$.alert(n.ResultMsg,"")},!0)}function ShareDetailedList(n){for(var r,i="",t=0;t<n.length;t++)r=taskObjAll.find(function(i){return i.ID==n[t].T_ID}),i+='<div class="weui-cell task-list" onclick="TaskDetailShow('+r.ID+');">',i+='<div class="weui-cell__bd weui-cell__primary"><p  class="task-name">'+r.T_NAME+'<span class="pull-right orange">共赚赏金<b class="text-l ">￥'+(n[t].ADOPT_COUNT*r.R_FXJL1).toFixed(1)+"<\/b><\/span><\/p>",i+='<div class="task-label text-s">报名:'+n[t].ALL_COUNT+"  提交:"+n[t].SUBMIT_COUNT+"  待审:"+n[t].WAIT_COUNT+"  失败:"+n[t].NOT_ADOPT_COUNT+"  <span class='green'>通过:"+n[t].ADOPT_COUNT+"<\/span><\/div>",i+="<\/div><\/div>";$("#detils_lists").html(i)}function BindEvent(){$("#txt_telephone").bind("input propertychange",function(){var n=$(this);n.val().length==11&&$("#btn_verify_code").html().indexOf("重发")<0?$("#btn_verify_code").removeClass("weui-btn_disabled weui-btn_default").addClass("weui-btn_primary"):$("#btn_verify_code").removeClass("weui-btn_primary").addClass("weui-btn_disabled weui-btn_default")});$("#btn_verify_code").click(function(){if($("#txt_telephone").val()==""){$.alert("请输入常用手机号。","");return}if($("#txt_telephone").val()&&/^1[3|4|5|7|8]\d{9}$/.test($("#txt_telephone").val())==!1){$.alert("手机号格式错误。","");return}if($this=$(this),$this.hasClass("weui-btn_disabled"))return!1;GetTelephoneVerifyCode()});$("#tasks").on("click","img.task_step_item_img",function(){var n=$(this);$("#gallery").find("span").css("background-image","url("+this.src+")");$("#gallery").fadeIn(100)})}function SubmitUserAuthentication(){if(CheckAuthenticationInfo()){var n=$("#txt_name").val(),t=$("#txt_telephone").val(),r=$("#txt_MessageTest").val(),i=$("#txt_idcard").val();$.showLoading("请稍候");$.ajax({type:"post",contentType:"text/json",url:"/user/UserAuthentication/"+OPENID+"/"+Token,data:'{"U_NAME":"'+n+'","U_PHONE":"'+t+'","M_TEST":"'+r+'","U_IDCARD":"'+i+'"}',dataType:"json",error:function(){$.hideLoading();$.alert("网络和服务器去开房了，请稍后再试！","")},success:function(r){$.hideLoading();r.ResultCode==0?(MyInfo.U_NAME=n,MyInfo.U_PHONE=t,MyInfo.U_IDCARD=i,$.modal({title:"",text:"提交成功",buttons:[{text:"确定",className:"default",onClick:function(){OverallBack();CheckIsAuthentication()}}]})):$.modal({title:"",text:r.ResultMsg})}})}}function CheckAuthenticationInfo(){var n=/^\s*$/g;if($("#txt_telephone").val()&&/^1[3|4|5|7|8]\d{9}$/.test($("#txt_telephone").val())==!1){$.alert("手机号格式错误。","");return}if(n.test($("#txt_MessageTest").val()))return $.alert("验证码不能为空",""),!1;if(!$("div[name='cell_nickname']").hasClass("hidden")){if(n.test($("#txt_idcard").val()))return $.alert("身份证不能为空",""),!1;if(n.test($("#txt_name").val()))return $.alert("姓名不能为空",""),!1;if(checkChineseName($("#txt_name").val())){if($("#txt_name").val()==MyInfo.U_NICKNAME&&checkNameFlag)return $.modal({title:"",text:"您输入的姓名和您的微信昵称相同，请确认此姓名是否为您开通微信钱包时所绑定的银行卡使用的姓名，否则无法提现！<br><p class='text-m orange'>是否确认使用此姓名:["+MyInfo.U_NICKNAME+"]？<\/p>",buttons:[{text:"否",className:"default",onClick:function(){}},{text:"是",onClick:function(){checkNameFlag=!1;SubmitUserAuthentication()}},]}),!1}else return $.alert("请输入您开通微信钱包时所绑定的银行卡使用的姓名，否则将无法提现！","姓名格式不对"),!1}return!0}function GetTelephoneVerifyCode(){var n=$("#btn_verify_code");n.html("发送中");n.addClass("weui-btn_disabled weui-btn_default").removeClass("weui-btn_primary");$.ajax({type:"post",contentType:"text/json",url:"/user/SendSMS",dataType:"json",data:'{"M_PHONE":"'+$("#txt_telephone").val()+'","M_WXOPENID":"'+OPENID+'"}',error:function(){n.removeClass("weui-btn_disabled weui-btn_default").addClass("weui-btn_primary");n.html("重发");$.alert("响应超时！","")},success:function(t){t.ResultCode==0?($.toast("已发送成功，<br/>有效期30分钟，<br/>请尽快验证。"),n.html("(60)重发"),setTimeout(function(){downCount(n)},1e3)):(n.removeClass("weui-btn_disabled weui-btn_default").addClass("weui-btn_primary"),n.html("重发"),$.alert(t.ResultOBJ,""))}})}function downCount(n){time<=0?(n.html("重新发送"),n.removeClass("weui-btn_disabled weui-btn_default"),n.addClass("weui-btn_primary"),time=60):(n.html("("+time+")重发"),--time,setTimeout(function(){downCount(n)},1e3))}var gRestrictEnum,currentAction,checkNameFlag,time;(function(n){n.CountDown={begin:function(t,i){function e(){f>=0?(r.html(u+" <span style='font-size:12px'>("+o(f)+")<\/span>"),f--,r.attr("data-cd-timmeoutid",setTimeout(function(){e()},1e3))):(r.attr("data-cd-timmeoutid",0),r.html(u),i.callback())}function o(n){var i,t;return n==null?"0秒":n<60?n+"秒":n<3600?(t=n%60,t=t<10?"0"+t:t,parseInt(n/60)+"分"+t+"秒"):(i=n%3600,t=i%60==0?0:i%60,i=parseInt(i/60),i=i<10?"0"+i:i,t=t<10?"0"+t:t,parseInt(n/3600)+"时"+i+"分"+t+"秒")}var r=n(t),u,f;r.attr("data-cd-timmeoutid")!="0"&&(clearTimeout(r.attr("data-cd-timmeoutid")),r.html(r.attr("data-cd-html")));i=n.extend(!0,{countDown:5,callback:function(){console.log("countdown is ok")}},i);u=r.html();f=i.countDown;r.attr("data-cd-html",u);e()},stop:function(t){var i=n(t);i.attr("data-cd-timmeoutid")!="0"&&(clearTimeout(i.attr("data-cd-timmeoutid")),i.html(i.attr("data-cd-html")))}}})(jQuery);gRestrictEnum={1:{name:"开始时间"},2:{name:"结束时间"},3:{name:"地域限制"},4:{name:"不可申述"},5:{name:"地域半径"},6:{name:"开放时间"},7:{name:"数量限制"},8:{name:"可见星级"},9:{name:"拉人星级"},10:{name:"是否允许开干"},11:{name:"是否能导入盒子"},12:{name:"是否裂变"},13:{name:"取证手段"},14:{name:"埋点描述"},15:{name:"前置问卷"},16:{name:"待审单描述"},17:{name:"静默授权"},18:{name:"任务步骤描述"},19:{name:"拉人分享语"},20:{name:"任务分享语"},21:{name:"一级分享奖励"},22:{name:"二级分享奖励"},23:{name:"无需审核任务"}};var uploader,accessid="zydL2DWCGEi2B5GC",accesskey="EVgAQrK5XO6d2Y4AkVSNnUBJjbUDja",host="//ditui.oss-cn-beijing.aliyuncs.com",policyText={expiration:"2020-01-01T12:00:00.000Z",conditions:[["content-length-range",0,10485760]]},policyBase64=Base64.encode(JSON.stringify(policyText)),bytes=Crypto.HMAC(Crypto.SHA1,policyBase64,accesskey,{asBytes:!0}),signature=Crypto.util.bytesToBase64(bytes);currentAction=0;checkNameFlag=!0;time=60;